{% extends "template.html" %}

{% set active_page = "about" %}

{% block content %}
<div class="container shadow rounded fadeIn p-5 my-5 bg-white" id="content">

        <h2>Training a Machine Learning Model to Predict Diabetes Diagnosis</h2>
        <br><br>
        <p>This application leverages the power of machine learning to predict a
            patient's diabetes diagnosis based on a meticulously crafted questionnaire capturing a range of related
            symptoms. The data that fuels this remarkable model comes straight from the renowned University of
            California Irving Machine Learning Repositories, where groundbreaking discoveries are made. Find the
            official data site right <a
                href='https://archive.ics.uci.edu/ml/datasets/Early+stage+diabetes+risk+prediction+dataset.'
                target='_blank' class='url'>here</a>.</p>
        <br><br>
        <h4>Cleaning and Transforming the Data</h4><br>
        <p>The very first step is always to make sure the date you are using is worthwhile. As they say, you are what
            you eat. So first we will clean and transform the data, preparing it to be devoured by our machine learning
            models. For reference here is a sample of the data we will be working with in its raw form:</p>
        <br>
        <div class="scrollme">
            <figure>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Polyuria</th>
                            <th>Polydipsia</th>
                            <th>sudden weight loss</th>
                            <th>weakness</th>
                            <th>Polyphagia</th>
                            <th>Genital thrush</th>
                            <th>visual blurring</th>
                            <th>Itching</th>
                            <th>Irritability</th>
                            <th>delayed healing</th>
                            <th>partial paresis</th>
                            <th>muscle stiffness</th>
                            <th>Alopecia</th>
                            <th>Obesity</th>
                            <th>class</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>40</td>
                            <td>Male</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Positive</td>
                        </tr>
                        <tr>
                            <td>58</td>
                            <td>Male</td>
                            <td>No</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Positive</td>
                        </tr>
                        <tr>
                            <td>41</td>
                            <td>Male</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Positive</td>
                        </tr>
                        <tr>
                            <td>45</td>
                            <td>Male</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>No</td>
                            <td>No</td>
                            <td>No</td>
                            <td>Positive</td>
                        </tr>
                        <tr>
                            <td>60</td>
                            <td>Male</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Positive</td>
                        </tr>
                    </tbody>
                </table>
            </figure>
        </div><br><br>
        <p>&#39;Male/Female&#39; fields as well as &#39;Yes/No&#39; fields will be replaced with binary True and False
            in order to be understood by our machine learning model. After these transformations the data now looks like
            this:
        </p>
        <br>
        <div class="scrollme">
            <figure>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Polyuria</th>
                            <th>Polydipsia</th>
                            <th>sudden weight loss</th>
                            <th>weakness</th>
                            <th>Polyphagia</th>
                            <th>Genital thrush</th>
                            <th>visual blurring</th>
                            <th>Itching</th>
                            <th>Irritability</th>
                            <th>delayed healing</th>
                            <th>partial paresis</th>
                            <th>muscle stiffness</th>
                            <th>Alopecia</th>
                            <th>Obesity</th>
                            <th>class</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>40</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>58</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>41</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>45</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>60</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                        </tr>
                    </tbody>
                </table>
            </figure>
        </div><br><br>
        <p>Now we can generate a confusion matrix (or heatmap) to visualize the relationship between different symptoms.
            We
            can see from the confusion matrix that the conditions polyuria and polydipsia are the most strongly
            correlated
            to a positive diabetes diagnosis. We can expect that they will be an important factor in any machine
            learning
            models prediction.</p>
        <br>
        <div class="text-center"><img class="img-fluid"
                src="{{ url_for('static',     filename='confusion_matrix.png') }}" /></div>
        <p>&nbsp;</p><br>
        <h4>Pruning Data Features</h4><br>
        <p>The next step will be to use a machine learning model called a <em>decision tree classifier</em> to help
            select
            the most important features (which in this case represent symptoms) from the dataset. After training the
            decision tree classifier on the model, the following graph of feature importance is created.</p>
        <br><br>
        <div class="text-center"><iframe width="100%" height="500" frameborder="0" scrolling="no"
                src="//plotly.com/~taylorsegell/160.embed"></iframe></div>
        <br>
        <p>Next we will use a process called <em>recursive feature elimination with cross-validation</em> in order to
            automatically select the most important features to retain from out dataset, based on the assessments made
            earlier by the decision tree classifier. After this process is complete, our features are reduced from 17 to
            11.
            Here is what the dataset looks like after feature pruning:</p>
        <br>
        <div class="scrollme">
            <figure>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Polyuria</th>
                            <th>Polydipsia</th>
                            <th>sudden weight loss</th>
                            <th>Genital thrush</th>
                            <th>Irritability</th>
                            <th>delayed healing</th>
                            <th>muscle stiffness</th>
                            <th>Alopecia</th>
                            <th>Obesity</th>
                            <th>class</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>40</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>58</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>41</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>45</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>False</td>
                            <td>False</td>
                            <td>False</td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td>60</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>False</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                            <td>True</td>
                        </tr>
                    </tbody>
                </table>
            </figure>
        </div><br><br>
        <h4>Comparing the Models</h4><br>
        <p>Now that the data is prepared, it&#39;s time to choose a machine learning model with which to make
            predictions
            and build our application. We will fit, train, and compare the accuracy of 5 potential models: <em>K nearest
                neighbors classifier</em>, a <em>Logistic Regression classifier</em>, a <em>Support Vector
                classifier</em>, a <em>Gaussian Naive Bayes classifier</em>, and a <em>Random Forest
                classifier</em>. After fitting and training these 5 models, a 5 fold cross validation will be used to
            compare their results. The results can be seen in the graph below.</p>
        <br><br>
        <div class="text-center"><iframe src="https://chart-studio.plotly.com/~taylorsegell/158.embed" width="100%"
                height="500"></iframe></div>
        <br>

        <h3>Model Selection</h3>
        <p>To determine which model is the best for the diabetes prediction, we need to consider the performance metrics
            (accuracy, precision, and recall) for each model. Generally, a good model should have high values for
            accuracy, precision, and recall.</p>
        <br>
        <p><i>Based on the scores:</i></p>
        <ul>
            <li><strong>Random Forest</strong> has the highest accuracy, precision, and recall among all models, making
                it the top-performing model overall.</li>
            <li><strong>Random Forest</strong> has an accuracy of approximately 96.92%, which means it correctly
                predicts about 96.92% of the cases, making it highly accurate.</li>
            <li><strong>Random Forest</strong> has a precision of approximately 97.03%, indicating that it has a high
                true positive rate among the predicted positive cases.</li>
            <li><strong>Random Forest</strong> has a recall of approximately 98.44%, meaning it correctly identifies
                about 98.44% of the actual positive cases, making it effective in capturing true positive instances.
            </li>
        </ul>
        <p>Considering these metrics, the <strong>Random Forest</strong> model appears to be the best model for the
            diabetes prediction task, as it shows consistently high performance across all three metrics. However, it is
            essential to perform further evaluation and analysis to ensure the model's robustness and generalization
            capability. Additionally, depending on the specific application and requirements, other models might be
            preferred if certain metrics are of higher importance in the context of the problem.</p>
        <h4>Model Overview</h4><br>
        <p>Now that we have selected the model for our application here is a more detailed view of how it was built.</p>

        <br><br>
        <div class="text-center"><img class="img-fluid" src="{{ url_for('static',     filename='best_model.png') }}" />
        </div>
        <br><br>
        <h4>Assessing the models accuracy</h4><br>
        <p>Finally we can review 3 metrics to asses the accuracy of the trained model: accuracy, precision, and recall.
        </p>
        <div class="scrollme">
            <figure>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Algorithm</th>
                            <th>Accuracy</th>
                            <th>Precision</th>
                            <th>Recall</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Random Forest</td>
                            <td style="background-color: yellow;">0.971154</td>
                            <td>0.964728</td>
                            <td>0.987500</td>
                        </tr>
                        <tr>
                            <td>Logistic Regression</td>
                            <td>0.921154</td>
                            <td>0.939721</td>
                            <td>0.934375</td>
                        </tr>
                        <tr>
                            <td>Support Vector Machine</td>
                            <td>0.903846</td>
                            <td style="background-color: yellow;">0.942697</td>
                            <td>0.900000</td>
                        </tr>
                        <tr>
                            <td>K-Nearest Neighbors</td>
                            <td>0.934615</td>
                            <td>0.973655</td>
                            <td>0.918750</td>
                        </tr>
                        <tr>
                            <td>Gaussian Naive Bayes</td>
                            <td>0.869231</td>
                            <td>0.886730</td>
                            <td style="background-color: yellow;">0.909375</td>
                        </tr>
                    </tbody>
                </table>
            </figure>

        </div><br>
        <br>
        <p>Although the model performs well on all 3 metrics, recall can be considered the metric of most importance in
            this
            particular application. Recall measures false negatives against true positives, and is of particular weight
            when
            dealing with medical issues, when it&#39;s very important to avoid false negatives.</p>
        <br><br>
        <h4>Deploying the trained model</h4><br>
        <p>Now that the model is trained, all that&#39;s left is to deploy it to the web application! </p>
        <p>If you would like to view the jupyter notebook containing all of the code necessary for processing the data and
            training the model as discussed above, click <a
                href="https://github.com/taylorsegell/Diabetes-Predictor-Application/blob/master/models-notebook.ipynb">here</a>.</a>
        </p>

        <br><br>
        <h6>Credits</h6>
        <p>This project was inspired by <a href='https://github.com/Dylan-Cairns'>Dylan Cairns</a> and his Diabetes
            Predictor App. He without question laid the groundwork when createing it. I simply took his repo as a boiler
            plate and revamped it for 2023 along with a few more models.</p>
        <p>If you would like to view the jupyter notebook containing all of the code Dylan forged that was necessary for
            processing the data and
            training the model as discussed above, click <a
                href="https://github.com/Dylan-Cairns/ML-Diabetes-Prediction/blob/master/diabetes_jupyter_notebook.ipynb">here</a>.</a>
        </p>
    </div>
  

    {% endblock %}